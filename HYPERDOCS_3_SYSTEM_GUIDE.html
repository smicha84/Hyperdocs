<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hyperdocs 3 â€” System Guide</title>
<style>
:root { --bg: #08080e; --s1: #0e0e18; --border: #1e1e30; --text: #b8b8c8; --dim: #555568; --white: #eeeef2; --blue: #7aa2f7; --green: #9ece6a; --yellow: #e0af68; --red: #f7768e; --purple: #bb9af7; --cyan: #73daca; --orange: #ff9e64; }
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace; background: var(--bg); color: var(--text); font-size: 13px; line-height: 1.5; }
.page { max-width: 900px; margin: 0 auto; padding: 32px 20px; }
h1 { color: var(--white); font-size: 20px; font-weight: 600; }
h1 span { color: var(--blue); }
.sub { color: var(--dim); font-size: 11px; margin: 2px 0 24px; }
.io { display: grid; grid-template-columns: 1fr auto 1fr; gap: 12px; align-items: center; margin: 20px 0; padding: 16px; background: var(--s1); border: 1px solid var(--border); border-radius: 8px; }
.io-box { padding: 12px; border-radius: 6px; text-align: center; }
.io-in { background: #0d1a0d; border: 1px solid #1a3a1a; }
.io-out { background: #1a1a0d; border: 1px solid #3a3a1a; }
.io-arrow { color: var(--dim); font-size: 24px; }
.io-label { font-size: 10px; color: var(--dim); text-transform: uppercase; letter-spacing: 1px; }
.io-val { color: var(--white); font-size: 13px; margin-top: 4px; }
.phase { margin: 0 0 20px; }
.phase-header { display: flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: 6px 6px 0 0; }
.ph0 .phase-header { background: #0d1a0d; border: 1px solid #1a3a1a; border-bottom: none; }
.ph1 .phase-header { background: #0d0d1a; border: 1px solid #1a1a3a; border-bottom: none; }
.ph2 .phase-header { background: #1a0d1a; border: 1px solid #3a1a3a; border-bottom: none; }
.ph3 .phase-header { background: #1a1a0d; border: 1px solid #3a3a1a; border-bottom: none; }
.ph4 .phase-header { background: #0d1a1a; border: 1px solid #1a3a3a; border-bottom: none; }
.ph5 .phase-header { background: #1a0d0d; border: 1px solid #3a1a1a; border-bottom: none; }
.phase-num { font-size: 11px; font-weight: 700; padding: 2px 8px; border-radius: 3px; }
.ph0 .phase-num { background: #1a3a1a; color: var(--green); }
.ph1 .phase-num { background: #1a1a3a; color: var(--blue); }
.ph2 .phase-num { background: #3a1a3a; color: var(--purple); }
.ph3 .phase-num { background: #3a3a1a; color: var(--yellow); }
.ph4 .phase-num { background: #1a3a3a; color: var(--cyan); }
.ph5 .phase-num { background: #3a1a1a; color: var(--red); }
.phase-title { color: var(--white); font-size: 13px; font-weight: 600; flex: 1; }
.phase-meta { color: var(--dim); font-size: 11px; }
.phase-desc { padding: 8px 14px; font-size: 11px; color: var(--dim); border-left: 1px solid; border-right: 1px solid; }
.ph0 .phase-desc { border-color: #1a3a1a; }
.ph1 .phase-desc { border-color: #1a1a3a; }
.ph2 .phase-desc { border-color: #3a1a3a; }
.ph3 .phase-desc { border-color: #3a3a1a; }
.ph4 .phase-desc { border-color: #1a3a3a; }
.ph5 .phase-desc { border-color: #3a1a1a; }
.file-list { border-radius: 0 0 6px 6px; overflow: hidden; }
.file { display: grid; grid-template-columns: 20px 1fr auto; gap: 8px; padding: 5px 14px; align-items: center; border-bottom: 1px solid #0a0a12; }
.ph0 .file { background: #0a120a; border-left: 1px solid #1a3a1a; border-right: 1px solid #1a3a1a; }
.ph1 .file { background: #0a0a12; border-left: 1px solid #1a1a3a; border-right: 1px solid #1a1a3a; }
.ph2 .file { background: #120a12; border-left: 1px solid #3a1a3a; border-right: 1px solid #3a1a3a; }
.ph3 .file { background: #12120a; border-left: 1px solid #3a3a1a; border-right: 1px solid #3a3a1a; }
.ph4 .file { background: #0a1212; border-left: 1px solid #1a3a3a; border-right: 1px solid #1a3a3a; }
.ph5 .file { background: #120a0a; border-left: 1px solid #3a1a1a; border-right: 1px solid #3a1a1a; }
.file:last-child { border-radius: 0 0 6px 6px; }
.file:hover { filter: brightness(1.3); }
.file-icon { font-size: 11px; text-align: center; }
.file-name { font-size: 12px; }
.file-meta { font-size: 10px; color: var(--dim); text-align: right; white-space: nowrap; }
.script { color: var(--cyan); }
.agent { color: var(--purple); }
.arrow { text-align: center; color: var(--dim); font-size: 14px; margin: 4px 0; }
.note { background: var(--s1); border: 1px solid var(--border); border-radius: 6px; padding: 12px 14px; margin: 20px 0; font-size: 11px; }
.note strong { color: var(--white); }
.stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin: 16px 0; }
.stat { background: var(--s1); border: 1px solid var(--border); border-radius: 6px; padding: 10px; text-align: center; }
.stat .n { font-size: 20px; font-weight: 700; }
.stat .l { font-size: 9px; color: var(--dim); text-transform: uppercase; letter-spacing: 0.5px; margin-top: 2px; }
code { font-size: 11px; background: #1a1a2a; padding: 1px 5px; border-radius: 3px; color: var(--yellow); }
.footer { text-align: center; color: var(--dim); font-size: 10px; margin-top: 32px; padding-top: 16px; border-top: 1px solid var(--border); }
</style>
</head>
<body>
<div class="page">

<h1>hyperdocs_<span>3</span>/</h1>
<div class="sub">A system that reads Claude Code chat history and writes the truth into code files.</div>

<div class="io">
  <div class="io-box io-in">
    <div class="io-label">Input</div>
    <div class="io-val">Any Claude Code<br>chat history (.jsonl)</div>
  </div>
  <div class="io-arrow">&rarr; phases 0-5 &rarr;</div>
  <div class="io-box io-out">
    <div class="io-label">Output</div>
    <div class="io-val">Your project's code files<br>enhanced with hyperdoc comments</div>
  </div>
</div>

<div class="stats">
  <div class="stat"><div class="n" style="color:var(--cyan)">19</div><div class="l">Python Scripts</div></div>
  <div class="stat"><div class="n" style="color:var(--purple)">9</div><div class="l">Agent Definitions</div></div>
  <div class="stat"><div class="n" style="color:var(--white)">28</div><div class="l">Total System Files</div></div>
</div>

<!-- PHASE 0 -->
<div class="phase ph0">
  <div class="phase-header">
    <span class="phase-num">PHASE 0</span>
    <span class="phase-title">phase_0_prep/</span>
    <span class="phase-meta">$0 cost &middot; pure Python &middot; 7 files</span>
  </div>
  <div class="phase-desc">Reads a JSONL chat history. Enriches every message with 50+ metadata signals (file mentions, errors, frustration, tool results). Classifies into 4 tiers. Produces enriched data for agents.</div>
  <div class="file-list">
    <div class="file"><span class="file-icon">&#9654;</span><span class="file-name script">deterministic_prep.py</span><span class="file-meta">267 lines &middot; entry point</span></div>
    <div class="file"><span class="file-icon">&#9654;</span><span class="file-name script">prepare_agent_data.py</span><span class="file-meta">128 lines &middot; splits data for agents</span></div>
    <div class="file"><span class="file-icon">&#8627;</span><span class="file-name script">claude_session_reader.py</span><span class="file-meta">380 lines &middot; parses JSONL into messages</span></div>
    <div class="file"><span class="file-icon">&#8627;</span><span class="file-name script">metadata_extractor.py</span><span class="file-meta">901 lines &middot; 50+ signals per message</span></div>
    <div class="file"><span class="file-icon">&#8627;</span><span class="file-name script">message_filter.py</span><span class="file-meta">331 lines &middot; 4-tier classification</span></div>
    <div class="file"><span class="file-icon">&#8627;</span><span class="file-name script">claude_behavior_analyzer.py</span><span class="file-meta">548 lines &middot; context damage detection</span></div>
    <div class="file"><span class="file-icon">&#8627;</span><span class="file-name script">geological_reader.py</span><span class="file-meta">446 lines &middot; message data classes</span></div>
  </div>
</div>

<div class="arrow">&#9660;</div>

<!-- PHASE 1 -->
<div class="phase ph1">
  <div class="phase-header">
    <span class="phase-num">PHASE 1</span>
    <span class="phase-title">phase_1_extraction/</span>
    <span class="phase-meta">4 parallel agents &middot; 6 files</span>
  </div>
  <div class="phase-desc">Four agents run in parallel. Each reads the enriched session from a different angle: analytical threads, geological layers, semantic primitives, and free exploration.</div>
  <div class="file-list">
    <div class="file"><span class="file-icon">&#9673;</span><span class="file-name agent">thread-analyst.md</span><span class="file-meta">97 lines &middot; 6 threads + markers</span></div>
    <div class="file"><span class="file-icon">&#9654;</span><span class="file-name script">extract_threads.py</span><span class="file-meta">663 lines &middot; helper script</span></div>
    <div class="file"><span class="file-icon">&#9673;</span><span class="file-name agent">geological-reader.md</span><span class="file-meta">77 lines &middot; micro/meso/macro zoom</span></div>
    <div class="file"><span class="file-icon">&#9673;</span><span class="file-name agent">primitives-tagger.md</span><span class="file-meta">78 lines &middot; 7 semantic dimensions</span></div>
    <div class="file"><span class="file-icon">&#9654;</span><span class="file-name script">tag_primitives.py</span><span class="file-meta">614 lines &middot; helper script</span></div>
    <div class="file"><span class="file-icon">&#9673;</span><span class="file-name agent">free-explorer.md</span><span class="file-meta">61 lines &middot; unconstrained notes</span></div>
  </div>
</div>

<div class="arrow">&#9660;</div>

<!-- PHASE 2 -->
<div class="phase ph2">
  <div class="phase-header">
    <span class="phase-num">PHASE 2</span>
    <span class="phase-title">phase_2_synthesis/</span>
    <span class="phase-meta">2 agents &middot; 2 files</span>
  </div>
  <div class="phase-desc">Builds an idea evolution graph (nodes = ideas, edges = transitions like pivoted/abandoned/evolved). Runs 6-pass temperature-ramped synthesis producing grounded warnings, patterns, and metrics.</div>
  <div class="file-list">
    <div class="file"><span class="file-icon">&#9673;</span><span class="file-name agent">idea-graph-builder.md</span><span class="file-meta">95 lines &middot; directed graph of ideas</span></div>
    <div class="file"><span class="file-icon">&#9673;</span><span class="file-name agent">synthesizer.md</span><span class="file-meta">98 lines &middot; 6-pass (temp 0.3&rarr;1.0&rarr;0.0)</span></div>
  </div>
</div>

<div class="arrow">&#9660;</div>

<!-- PHASE 3 -->
<div class="phase ph3">
  <div class="phase-header">
    <span class="phase-num">PHASE 3</span>
    <span class="phase-title">phase_3_hyperdoc_writing/</span>
    <span class="phase-meta">3 agent defs + 4 scripts &middot; 7 files</span>
  </div>
  <div class="phase-desc">Maps all analysis to specific code files (per-file dossiers). Then launches one dedicated agent per file to write structured hyperdocs: header block, inline function annotations, footer block.</div>
  <div class="file-list">
    <div class="file"><span class="file-icon">&#9673;</span><span class="file-name agent">file-mapper.md</span><span class="file-meta">113 lines &middot; per-file dossiers</span></div>
    <div class="file"><span class="file-icon">&#9654;</span><span class="file-name script">generate_dossiers.py</span><span class="file-meta">837 lines &middot; cross-references all data</span></div>
    <div class="file"><span class="file-icon">&#9673;</span><span class="file-name agent">hyperdoc-writer-per-file.md</span><span class="file-meta">266 lines &middot; header + inline + footer</span></div>
    <div class="file"><span class="file-icon">&#9673;</span><span class="file-name agent">hyperdoc-writer.md</span><span class="file-meta">99 lines &middot; v1 monolithic (reference)</span></div>
    <div class="file"><span class="file-icon">&#9654;</span><span class="file-name script">write_hyperdocs.py</span><span class="file-meta">591 lines &middot; v1 writer</span></div>
    <div class="file"><span class="file-icon">&#9654;</span><span class="file-name script">generate_remaining_hyperdocs.py</span><span class="file-meta">333 lines &middot; template fallback</span></div>
    <div class="file"><span class="file-icon">&#9654;</span><span class="file-name script">generate_viewer.py</span><span class="file-meta">349 lines &middot; HTML viewer</span></div>
  </div>
</div>

<div class="arrow">&#9660;</div>

<!-- PHASE 4 -->
<div class="phase ph4">
  <div class="phase-header">
    <span class="phase-num">PHASE 4</span>
    <span class="phase-title">phase_4_insertion/</span>
    <span class="phase-meta">Python only &middot; 3 files</span>
  </div>
  <div class="phase-desc">AST-based smart insertion. Parses each target code file to find classes and functions. Places header after imports, inline annotations before specific functions, footer at EOF. Archives to versioned store.</div>
  <div class="file-list">
    <div class="file"><span class="file-icon">&#9654;</span><span class="file-name script">insert_hyperdocs_v2.py</span><span class="file-meta">348 lines &middot; smart placement</span></div>
    <div class="file"><span class="file-icon">&#9654;</span><span class="file-name script">insert_hyperdocs.py</span><span class="file-meta">242 lines &middot; v1 placement (reference)</span></div>
    <div class="file"><span class="file-icon">&#9654;</span><span class="file-name script">hyperdoc_store_init.py</span><span class="file-meta">193 lines &middot; versioned storage</span></div>
  </div>
</div>

<div class="arrow">&#9660;</div>

<!-- PHASE 5 -->
<div class="phase ph5">
  <div class="phase-header">
    <span class="phase-num">PHASE 5</span>
    <span class="phase-title">phase_5_ground_truth/</span>
    <span class="phase-meta">Python only &middot; no LLM &middot; 3 files</span>
  </div>
  <div class="phase-desc">Verifies claims made during the session against actual code state. Extracts claims from pipeline data, runs 8 independent checks (AST, regex, importlib), produces per-file credibility scores and unfinished business reports.</div>
  <div class="file-list">
    <div class="file"><span class="file-icon">&#9654;</span><span class="file-name script">claim_extractor.py</span><span class="file-meta">295 lines &middot; extracts typed claims</span></div>
    <div class="file"><span class="file-icon">&#9654;</span><span class="file-name script">ground_truth_verifier.py</span><span class="file-meta">393 lines &middot; 8 Python checks</span></div>
    <div class="file"><span class="file-icon">&#9654;</span><span class="file-name script">gap_reporter.py</span><span class="file-meta">240 lines &middot; credibility scores</span></div>
  </div>
</div>

<!-- HOW TO RUN -->
<div class="note">
  <strong>How to run:</strong><br><br>
  <span style="color:var(--green)">0.</span> <code>python3 phase_0_prep/deterministic_prep.py</code> &rarr; <code>python3 phase_0_prep/prepare_agent_data.py</code><br>
  <span style="color:var(--blue)">1.</span> Launch 4 agents in parallel (thread-analyst, geological-reader, primitives-tagger, free-explorer)<br>
  <span style="color:var(--purple)">2.</span> Launch 2 agents (idea-graph-builder, synthesizer)<br>
  <span style="color:var(--yellow)">3.</span> Launch file-mapper, then 15 per-file hyperdoc-writer agents in batches of 4<br>
  <span style="color:var(--cyan)">4.</span> <code>python3 phase_4_insertion/insert_hyperdocs_v2.py</code> &rarr; <code>python3 phase_4_insertion/hyperdoc_store_init.py</code><br>
  <span style="color:var(--red)">5.</span> <code>python3 phase_5_ground_truth/claim_extractor.py</code> &rarr; <code>ground_truth_verifier.py</code> &rarr; <code>gap_reporter.py</code>
</div>

<div class="note">
  <strong>Legend:</strong>&nbsp;&nbsp;
  <span class="script">&#9654; script</span> &nbsp;Python&nbsp;&nbsp;
  <span class="agent">&#9673; agent</span> &nbsp;Claude Code agent definition&nbsp;&nbsp;
  <span class="script">&#8627; import</span> &nbsp;imported by a script above it
</div>

<div class="footer">
  hyperdocs_3 &middot; 28 system files &middot; 6 phases &middot; 19 scripts &middot; 9 agents
</div>

</div>
</body>
</html>
